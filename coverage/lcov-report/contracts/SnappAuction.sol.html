<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/SnappAuction.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> SnappAuction.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>91/91</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>60/60</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>22/22</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>95/95</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">62×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1558×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1554×</span>
<span class="cline-any cline-yes">1554×</span>
<span class="cline-any cline-yes">1551×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">69×</span>
<span class="cline-any cline-yes">69×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">69×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">19×</span>
<span class="cline-any cline-yes">19×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">17×</span>
<span class="cline-any cline-yes">15×</span>
<span class="cline-any cline-yes">15×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">22×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">22×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">15×</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">64×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">62×</span>
<span class="cline-any cline-yes">62×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1053×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1053×</span>
<span class="cline-any cline-yes">1049×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1045×</span>
<span class="cline-any cline-yes">1045×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1045×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">27×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">25×</span>
<span class="cline-any cline-yes">23×</span>
<span class="cline-any cline-yes">21×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">19×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">17×</span>
<span class="cline-any cline-yes">15×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">24×</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-yes">18×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">10×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">33×</span>
<span class="cline-any cline-yes">33×</span>
<span class="cline-any cline-yes">1552×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1550×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">31×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1554×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1019×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1086×</span>
<span class="cline-any cline-yes">1080×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1074×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1075×</span>
<span class="cline-any cline-yes">1075×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1075×</span>
<span class="cline-any cline-yes">1075×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">66×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">62×</span>
<span class="cline-any cline-yes">62×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1053×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">54×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">pragma solidity ^0.5.0;
&nbsp;
import "./SnappBase.sol";
import "solidity-bytes-utils/contracts/BytesLib.sol";
&nbsp;
&nbsp;
contract SnappAuction is SnappBase {
    using BytesLib for bytes;
&nbsp;
    uint public constant MAX_UINT = 2**256 - 1;
    uint16 public constant AUCTION_BATCH_SIZE = 1000;
    uint16 public constant AUCTION_RESERVED_ACCOUNTS = 50;
    uint16 public constant AUCTION_RESERVED_ACCOUNT_BATCH_SIZE = 10;
&nbsp;
    struct StandingOrderBatch {
        bytes32 orderHash;
        uint validFromIndex; // validity is inclusive of the auction index
        // validToIndex is indirectly given as validFromIndex of next Orderbatch
    }
&nbsp;
    struct StandingOrderData {
        mapping(uint =&gt; StandingOrderBatch) reservedAccountOrders;
        uint currentBatchIndex;
    }
&nbsp;
    mapping (uint16 =&gt; StandingOrderData) public standingOrders;
&nbsp;
    uint public auctionIndex = MAX_UINT;
&nbsp;
    struct PendingAuction {
        // Order Collection fields
        bytes32 orderHash;             // Rolling shaHash of all orders
        uint16 numOrders;              // Number of orders in this auction
        uint creationTimestamp;        // Timestamp of batch creation
        // Solution Bidding phase
        address solver;
        uint objectiveValue;           // Traders utility
        bytes32 tentativeState;        // Proposed account state during bidding phase
        // Auction Settlement phase
        bytes32 solutionHash;          // Succinct record of trade execution &amp; prices
        uint auctionAppliedTime;       // Time auction was applied (written at time of solutionHash)
        uint appliedAccountStateIndex; // stateIndex when batch applied - 0 implies unapplied.
    }
&nbsp;
    mapping (uint =&gt; PendingAuction) public auctions;
&nbsp;
    event SellOrder(
        uint auctionId,
        uint16 slotIndex,
        uint16 accountId,
        uint8 buyToken,
        uint8 sellToken,
        uint96 buyAmount,
        uint96 sellAmount
    );
&nbsp;
    event StandingSellOrderBatch(
        uint currentBatchIndex,
        uint validFromAuctionId,
        uint16 accountId,
        bytes packedOrders
    );
&nbsp;
    event AuctionSettlement(
        uint auctionId,
        uint stateIndex,
        bytes32 stateHash,
        bytes pricesAndVolumes
    );
&nbsp;
    event AuctionInitialization(
        uint16 maxOrders,
        uint16 numReservedAccounts,
        uint16 ordersPerReservedAccount
    );
&nbsp;
    constructor () public {
        emit AuctionInitialization(
            AUCTION_BATCH_SIZE, AUCTION_RESERVED_ACCOUNTS, AUCTION_RESERVED_ACCOUNT_BATCH_SIZE
        );
    }
&nbsp;
    /**
     * Public View Methods
     */
    function getAuctionCreationTimestamp(uint slot) public view returns (uint) {
        return auctions[slot].creationTimestamp;
    }
&nbsp;
    function getOrderHash(uint slot) public view returns (bytes32) {
        return auctions[slot].orderHash;
    }
&nbsp;
    function hasAuctionBeenApplied(uint slot) public view returns (bool) {
        return auctions[slot].appliedAccountStateIndex != 0;
    }
&nbsp;
    function getStandingOrderHash(uint16 userId, uint128 batchIndex) public view returns (bytes32) {
        return standingOrders[userId].reservedAccountOrders[batchIndex].orderHash;
    }
&nbsp;
    function getStandingOrderValidFrom(uint16 userId, uint128 batchIndex) public view returns (uint) {
        return standingOrders[userId].reservedAccountOrders[batchIndex].validFromIndex;
    }
&nbsp;
    function getStandingOrderValidTo(uint16 userId, uint128 batchIndex) public view returns (uint) {
        uint validTo = standingOrders[userId].reservedAccountOrders[batchIndex + 1].validFromIndex;
        if (validTo == 0) {
            return MAX_UINT;
        } else {
            return validTo - 1;
        }
    }
&nbsp;
    function getStandingOrderCounter(uint16 userId) public view returns (uint) {
        return standingOrders[userId].currentBatchIndex;
    }
&nbsp;
    function biddingStartTime(uint slot) public view returns (uint) {
        // Solution bidding can only begin once the previous auction has settled
        // A1: | order collection | solution bidding | solution posting |
        // A2: |                  | order collection | solution bidding |  solution posting
        // biddingStartTime = max(currentBatch.creationTimestamp + 3 minutes, previousBatch.auctionAppliedTime)
        uint bidStart = auctions[slot].creationTimestamp + 3 minutes;
        if (slot &gt; 0 &amp;&amp; auctions[slot-1].auctionAppliedTime &gt; bidStart) {
            bidStart = auctions[slot-1].auctionAppliedTime;
        }
        return bidStart;
    }
&nbsp;
    /**
     * Auction Functionality
     */
    function placeStandingSellOrder(
        bytes memory packedOrders
    ) public onlyRegistered() {
&nbsp;
        // Update Auction Hash based on request
        uint16 accountId = publicKeyToAccountMap(msg.sender);
        require(accountId &lt;= AUCTION_RESERVED_ACCOUNTS, "Account is not a reserved account");
&nbsp;
        require(packedOrders.length % 26 == 0, "Each order should be packed in 26 bytes!");
        uint numOrders = packedOrders.length / 26;
        require(numOrders &lt;= AUCTION_RESERVED_ACCOUNT_BATCH_SIZE, "Too many orders for reserved batch");
&nbsp;
        if (
            auctionIndex == MAX_UINT ||
            block.timestamp &gt; (auctions[auctionIndex].creationTimestamp + 3 minutes)
        ) {
            createNewPendingBatch();
        }
        bytes32 orderHash;
        for (uint i = 0; i &lt; numOrders; i++) {
            // solhint-disable-next-line indent
            (uint8 buyToken, uint8 sellToken, uint96 buyAmount, uint96 sellAmount) = decodeOrder(packedOrders.slice(26*i, 26));
&nbsp;
            orderHash = sha256(
                abi.encodePacked(
                    orderHash,
                    encodeOrder(accountId, buyToken, sellToken, buyAmount, sellAmount)
                )
            );
        }
        uint currentBatchIndex = standingOrders[accountId].currentBatchIndex;
        StandingOrderBatch memory currentOrderBatch = standingOrders[accountId].reservedAccountOrders[currentBatchIndex];
        if (auctionIndex &gt; currentOrderBatch.validFromIndex) {
            currentBatchIndex = currentBatchIndex + 1;
            standingOrders[accountId].currentBatchIndex = currentBatchIndex;
            currentOrderBatch = standingOrders[accountId].reservedAccountOrders[currentBatchIndex];
            currentOrderBatch.validFromIndex = auctionIndex;
            currentOrderBatch.orderHash = orderHash;
        } else {
            currentOrderBatch.orderHash = orderHash;
        }
        //TODO: The case auctionIndex &lt; currentOrderBatch.validFromIndex can happen once roll-backs are implemented
        //Then we have to revert the orderplacement
        standingOrders[accountId].reservedAccountOrders[currentBatchIndex] = currentOrderBatch;
        emit StandingSellOrderBatch(currentBatchIndex, auctionIndex, accountId, packedOrders);
    }
&nbsp;
    function placeSellOrder(
        uint8 buyToken,
        uint8 sellToken,
        uint96 buyAmount,
        uint96 sellAmount
    ) public {
        // Ignore first 4 bytes padding and last two bytes accountId
        bytes memory packed = abi.encodePacked(encodeOrder(0, buyToken, sellToken, buyAmount, sellAmount));
        placeSellOrders(BytesLib.slice(packed, 4, 26));
    }
&nbsp;
    function placeSellOrders(bytes memory packedOrders) public onlyRegistered() {
        // Note that this could result failure of all orders if even one fails.
        require(packedOrders.length % 26 == 0, "Each order should be packed in 26 bytes!");
        // TODO - use ECRecover from signature contained in first 65 bytes of packedOrder
        uint16 accountId = publicKeyToAccountMap(msg.sender);
        for (uint i = 0; i &lt; packedOrders.length / 26; i++) {
            // solhint-disable-next-line indent
            (uint8 buyToken, uint8 sellToken, uint96 buyAmount, uint96 sellAmount) = decodeOrder(packedOrders.slice(26*i, 26));
&nbsp;
            createNewPendingBatchIfNecessary();
            bytes32 nextAuctionHash = sha256(
                abi.encodePacked(
                    auctions[auctionIndex].orderHash,  // TODO - Below todo will affect this.
                    encodeOrder(accountId, buyToken, sellToken, buyAmount, sellAmount)
                )
            );
            // TODO - auctions.orderHash should only need to be updated once (per index) on the outside of this loop
            auctions[auctionIndex].orderHash = nextAuctionHash;
            emit SellOrder(
                auctionIndex, auctions[auctionIndex].numOrders, accountId, buyToken, sellToken, buyAmount, sellAmount
            );
            // Only increment size after event (so it is emitted as an index)
            auctions[auctionIndex].numOrders++;
        }
    }
&nbsp;
    function auctionSolutionBid(
        uint slot,
        bytes32 _currStateRoot,
        bytes32 _orderHash,
        uint128[] memory _standingOrderIndex,
        bytes32 proposedStateRoot,
        uint proposedObjectiveValue
    ) public {
        require(
            slot == 0 || auctions[slot-1].appliedAccountStateIndex != 0,
            "Previous auction not yet resolved!"
        );
&nbsp;
        // Ensure that auction batch is inactive, unprocessed and in correct phase for bidding
        require(auctions[slot].appliedAccountStateIndex == 0, "Auction already applied");
        require(slot != MAX_UINT &amp;&amp; slot &lt;= auctionIndex, "Requested auction slot does not exist");
        require(
            block.timestamp &gt; biddingStartTime(slot) || auctions[slot].numOrders == maxUnreservedOrderCount(),
            "Requested auction slot is still active"
        );
        require(
            block.timestamp &lt; biddingStartTime(slot) + 3 minutes,
            "Bidding period for this auction has expired"
        );
&nbsp;
        require(coreData.stateRoots[stateIndex()] == _currStateRoot, "Incorrect state root");
        require(calculateOrderHash(slot, _standingOrderIndex) == _orderHash, "Order hash doesn't agree");
&nbsp;
        // Ensure proposed value exceeds current max.
        require(
            auctions[slot].objectiveValue == 0 || proposedObjectiveValue &gt; auctions[slot].objectiveValue,
            "Proposed objective value is less than existing"
        );
&nbsp;
        // Set appropriate fields in auction batch
        auctions[slot].solver = msg.sender;
        auctions[slot].objectiveValue = proposedObjectiveValue;
        auctions[slot].tentativeState = proposedStateRoot;
    }
&nbsp;
    function applyAuction(
        uint slot,
        bytes32 _currStateRoot,
        bytes32 newStateRoot,          // Only needed in the case of fallback
        bytes memory pricesAndVolumes  // Can be empty in the trivial case.
    ) public onlyOwner() {
        // Auction related constraints (slot exists, is inactive, no previous auction pending and not already applied)
        require(slot != MAX_UINT &amp;&amp; slot &lt;= auctionIndex, "Requested auction slot does not exist");
        require(slot == 0 || auctions[slot-1].appliedAccountStateIndex != 0, "Must apply auction slots in order!");
        require(auctions[slot].appliedAccountStateIndex == 0, "Auction already applied");
&nbsp;
        // State related constraints (order hash and state root agree)
        require(coreData.stateRoots[stateIndex()] == _currStateRoot, "Incorrect state root");
&nbsp;
        // Phase related constraints
        require(
            block.timestamp &gt; auctions[slot].creationTimestamp + 3 minutes ||
                auctions[slot].numOrders == maxUnreservedOrderCount(),
            "Requested auction slot is still active"
        );
        require(
            block.timestamp &gt; biddingStartTime(slot) + 3 minutes,
            "Requested auction still in bidding phase or earlier"
        );
&nbsp;
        if (block.timestamp &lt; biddingStartTime(slot) + 270 seconds &amp;&amp; auctions[slot].solver != address(0)) {
            // Winner Apply Auction
            require(
                auctions[slot].solver == msg.sender,
                "Only winner of bidding phase may apply auction here"
            );
            internalApplyAuction(slot, auctions[slot].tentativeState, pricesAndVolumes);
        } else if (block.timestamp &lt; biddingStartTime(slot) + 6 minutes) {
            // Fallback Apply Auction
            internalApplyAuction(slot, newStateRoot, pricesAndVolumes);
        } else {
            // Trivial Apply Auction
            bytes memory trivialSolution;  // p_i = 1 and (bA, sA)_j = (0, 0) \forall i, j
            internalApplyAuction(slot, coreData.stateRoots[stateIndex()], trivialSolution);
        }
    }
&nbsp;
    function calculateOrderHash(uint slot, uint128[] memory _standingOrderIndex)
        public view returns (bytes32)
    {
        bytes32[] memory orderHashes = new bytes32[](AUCTION_RESERVED_ACCOUNTS);
        for (uint i = 0; i &lt; AUCTION_RESERVED_ACCOUNTS; i++) {
            require(
                orderBatchIsValidAtAuctionIndex(slot, uint8(i), _standingOrderIndex[i]),
                "non-valid standingOrderBatch referenced"
            );
            orderHashes[i] = standingOrders[uint16(i)].reservedAccountOrders[_standingOrderIndex[i]].orderHash;
        }
        return sha256(abi.encodePacked(auctions[slot].orderHash, orderHashes));
    }
&nbsp;
    function orderBatchIsValidAtAuctionIndex(uint _auctionIndex, uint8 userId, uint128 orderBatchIndex)
        public view returns(bool)
    {
        return _auctionIndex &gt;= getStandingOrderValidFrom(userId, orderBatchIndex) &amp;&amp;
            _auctionIndex &lt;= getStandingOrderValidTo(userId, orderBatchIndex);
    }
&nbsp;
    function maxUnreservedOrderCount() public pure returns (uint16) {
        return AUCTION_BATCH_SIZE - (AUCTION_RESERVED_ACCOUNTS * AUCTION_RESERVED_ACCOUNT_BATCH_SIZE);
    }
&nbsp;
    function encodeOrder(
        uint16 accountId,
        uint8 buyToken,
        uint8 sellToken,
        uint96 buyAmount,
        uint96 sellAmount
    )
        internal view returns (bytes32)
    {
        // Must have 0 &lt;= tokenId &lt; MAX_TOKENS anyway, so may as well ensure registered.
        require(buyToken &lt; coreData.numTokens, "Buy token is not registered");
        require(sellToken &lt; coreData.numTokens, "Sell token is not registered");
        // Could also enforce that buyToken != sellToken, but not technically illegal.
&nbsp;
        // solhint-disable-next-line max-line-length
        return bytes32(uint(accountId) + (uint(buyToken) &lt;&lt; 16) + (uint(sellToken) &lt;&lt; 24) + (uint(sellAmount) &lt;&lt; 32) + (uint(buyAmount) &lt;&lt; 128));
    }
&nbsp;
    function decodeOrder(bytes memory orderData) internal pure
        returns(uint8 buyToken, uint8 sellToken, uint96 buyAmount, uint96 sellAmount)
    {
        buyAmount = BytesLib.toUint96(orderData, 0);
        sellAmount = BytesLib.toUint96(orderData, 12);
&nbsp;
        sellToken = BytesLib.toUint8(orderData, 24);
        buyToken = BytesLib.toUint8(orderData, 25);
    }
&nbsp;
    function internalApplyAuction(
        uint slot,
        bytes32 newStateRoot,
        bytes memory pricesAndVolumes
    )
        internal
    {
        coreData.stateRoots.push(newStateRoot);
        auctions[slot].appliedAccountStateIndex = stateIndex();
        auctions[slot].solutionHash = sha256(pricesAndVolumes);
        auctions[slot].auctionAppliedTime = block.timestamp;
        emit AuctionSettlement(slot, stateIndex(), newStateRoot, pricesAndVolumes);
    }
&nbsp;
    function createNewPendingBatch() internal {
        require(
            auctionIndex == MAX_UINT || auctionIndex &lt; 2 || auctions[auctionIndex - 2].appliedAccountStateIndex != 0,
            "Too many pending auctions"
        );
        auctionIndex++;
        auctions[auctionIndex] = PendingAuction({
            orderHash: bytes32(0),
            numOrders: 0,
            creationTimestamp: block.timestamp,
            solver: address(0),
            objectiveValue: 0,
            tentativeState: bytes32(0),
            solutionHash: bytes32(0),
            auctionAppliedTime: 0,
            appliedAccountStateIndex: 0
        });
    }
&nbsp;
    function createNewPendingBatchIfNecessary() private {
        if (
            auctionIndex == MAX_UINT ||
            auctions[auctionIndex].numOrders == maxUnreservedOrderCount() ||
            block.timestamp &gt; (auctions[auctionIndex].creationTimestamp + 3 minutes)
        ) {
            createNewPendingBatch();
        }
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Wed Oct 23 2019 17:06:18 GMT+0200 (Central European Summer Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
